<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Áï•Ë™ûÊ≠£ÂºèÂêçÁß∞„ÇØ„Ç§„Ç∫ÔºàÂ§ßÁõõ„ÇäÁâàÔºâ</title>
    <style>
        /* „Éô„Éº„ÇπË®≠ÂÆö */
        :root {
            --primary-color: #3498db;
            --primary-dark: #2980b9;
            --success-color: #27ae60;
            --error-color: #e74c3c;
            --choice-color: #9b59b6;
            --choice-dark: #8e44ad;
            --party-color: #e67e22;
            --party-dark: #d35400;
            --bg-color: #f0f4f8;
            --text-color: #333;
        }

        * {
            box-sizing: border-box; 
        }

        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            background-color: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
            position: relative;
            transition: padding 0.3s;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
            line-height: 1.4;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        .screen { display: none; }
        .screen.active { 
            display: block; 
            animation: fadeIn 0.3s ease-out; 
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .menu-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            margin: 10px 0;
            padding: 1.2rem;
            font-size: 1.1rem;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            font-weight: bold;
            color: white;
            text-align: left;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        
        .menu-btn-content { display: flex; flex-direction: column; }
        .menu-arrow { font-size: 1.2rem; opacity: 0.7; }

        .btn-choice { background-color: var(--choice-color); box-shadow: 0 4px 0 var(--choice-dark); }
        .btn-solo { background-color: var(--primary-color); box-shadow: 0 4px 0 var(--primary-dark); }
        .btn-party { background-color: var(--party-color); box-shadow: 0 4px 0 var(--party-dark); }
        
        .menu-btn:active { transform: translateY(4px); box-shadow: none; }
        .menu-desc { font-size: 0.85rem; font-weight: normal; margin-top: 4px; opacity: 0.95; }

        .question-box {
            background-color: #eef2f7;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            word-wrap: break-word;
            position: relative;
        }
        
        .level-badge {
            position: absolute;
            top: -10px;
            right: 10px;
            background: #f1c40f;
            color: #fff;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .abbr-text {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 0;
            line-height: 1.2;
        }

        .label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
            display: block;
        }

        .action-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 14px 20px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
            width: 100%;
            max-width: 300px;
            box-shadow: 0 4px 0 var(--primary-dark);
            transition: transform 0.1s;
        }
        .action-btn:active { transform: translateY(4px); box-shadow: none; }

        .choices-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        .choice-btn {
            background-color: white;
            border: 2px solid #bdc3c7;
            color: #333;
            padding: 15px;
            font-size: 1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            text-align: center;
            overflow-wrap: break-word;
            word-wrap: break-word; 
            line-height: 1.4;
        }
        
        @media (hover: hover) {
            .choice-btn:hover:not([disabled]) {
                background-color: #ecf0f1;
                border-color: #95a5a6;
            }
        }

        .choice-btn.correct-choice {
            background-color: var(--success-color) !important;
            color: white !important;
            border-color: var(--success-color) !important;
        }
        .choice-btn.wrong-choice {
            background-color: var(--error-color) !important;
            color: white !important;
            border-color: var(--error-color) !important;
        }

        input[type="text"] {
            width: 100%;
            padding: 14px;
            font-size: 1.2rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 1rem;
            outline: none;
            text-align: center;
            -webkit-appearance: none;
        }
        input[type="text"]:focus { border-color: var(--primary-color); }

        .party-answer-box {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            display: none;
        }
        .party-answer-text {
            font-size: 1.6rem;
            font-weight: bold;
            color: var(--error-color);
            word-wrap: break-word;
        }
        .party-sub-text {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 8px;
        }

        .result-feedback-box {
            background: #fafafa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 10px;
            text-align: center;
            border: 1px solid #eee;
        }
        #result-message {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        .correct { color: var(--success-color); }
        .incorrect { color: var(--error-color); }

        .progress-container {
            width: 100%;
            background-color: #eee;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: var(--success-color);
            width: 0%;
            transition: width 0.3s;
        }

        .back-link {
            display: inline-block;
            margin-top: 25px;
            color: #999;
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 10px;
        }

        @media (max-width: 480px) {
            .container { padding: 1.5rem 1rem; width: 100%; }
            h1 { font-size: 1.3rem; }
            .abbr-text { font-size: 1.8rem; }
            .menu-btn { padding: 1rem; }
            .menu-desc { font-size: 0.8rem; }
            .choice-btn { padding: 12px; font-size: 0.95rem; }
            #result-message { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Áï•Ë™ûÊ≠£ÂºèÂêçÁß∞„ÇØ„Ç§„Ç∫</h1>
    <p class="subtitle">ÂÖ®50Âïè‰ª•‰∏äÔºÅ<br>„ÅÇ„Å™„Åü„ÅØ‰ΩïÂïèÁ≠î„Åà„Çâ„Çå„ÇãÔºü</p>

    <div id="menu-screen" class="screen active">
        <p style="margin-bottom: 1rem; font-weight:bold;">ÈÅä„Å≥Êñπ„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</p>
        
        <button class="menu-btn btn-choice" onclick="selectMode('choice')">
            <div class="menu-btn-content">
                <span>ü§î 4Êäû„É¢„Éº„Éâ</span>
                <span class="menu-desc">ÈÅ∏ÊäûËÇ¢„Åã„ÇâÈÅ∏„Å∂Ôºà„Çπ„Ç≥„Ç¢„ÅÇ„ÇäÔºâ</span>
            </div>
            <span class="menu-arrow">‚ñ∂</span>
        </button>

        <button class="menu-btn btn-solo" onclick="selectMode('solo')">
            <div class="menu-btn-content">
                <span>‚å®Ô∏è „Å≤„Å®„Çä„É¢„Éº„Éâ</span>
                <span class="menu-desc">ÂÖ•Âäõ„Åó„Å¶ÂÆüÂäõË©¶„ÅóÔºà„Çπ„Ç≥„Ç¢„ÅÇ„ÇäÔºâ</span>
            </div>
            <span class="menu-arrow">‚ñ∂</span>
        </button>
        
        <button class="menu-btn btn-party" onclick="selectMode('party')">
            <div class="menu-btn-content">
                <span>üó£Ô∏è „Åø„Çì„Å™„É¢„Éº„Éâ</span>
                <span class="menu-desc">ÂïèÈ°å„Å®Á≠î„Åà„ÇíË°®Á§∫Ôºà„Çπ„Ç≥„Ç¢„Å™„ÅóÔºâ</span>
            </div>
            <span class="menu-arrow">‚ñ∂</span>
        </button>
        <p style="font-size:0.8rem; color:#aaa; margin-top:20px;">‚ÄªÈü≥„ÅåÂá∫„Åæ„Åô üîà</p>
    </div>

    <div id="game-screen" class="screen">
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        
        <div class="question-box">
            <div id="level-badge" class="level-badge">LEVEL 1</div>
            <span class="label">„Åì„Çå„ÅÆÊ≠£ÂºèÂêçÁß∞„ÅØÔºü</span>
            <div id="question-text" class="abbr-text"></div>
        </div>

        <div id="choice-area" style="display:none;">
            <div id="choices-container" class="choices-container">
            </div>
        </div>

        <div id="solo-area" style="display:none;">
            <input type="text" id="answer-input" placeholder="„Åì„Åì„Å´ÂÖ•Âäõ..." autocomplete="off">
            <br>
            <button id="solo-submit-btn" class="action-btn" onclick="checkSoloAnswer()">ÂõûÁ≠î„Åô„Çã</button>
        </div>

        <div id="common-result-area" class="result-feedback-box" style="display:none;">
            <div id="result-message"></div>
            <div style="margin-top:10px;">
                Ê≠£Ëß£„ÅØÔºö<br><strong id="common-correct-text" style="font-size:1.3rem; color:#333;"></strong>
            </div>
            <button class="action-btn" onclick="nextQuestion()">Ê¨°„ÅÆÂïèÈ°å„Å∏</button>
        </div>

        <div id="party-area" style="display:none;">
            <button id="party-reveal-btn" class="action-btn" style="background-color:#e67e22; box-shadow: 0 4px 0 #d35400;" onclick="revealPartyAnswer()">Ê≠£Ëß£„ÇíË¶ã„Çã</button>
            
            <div id="party-answer-box" class="party-answer-box">
                <div class="party-answer-text" id="party-correct-text"></div>
                <div class="party-sub-text">Ôºà‰ªñÔºö<span id="party-alt-text"></span>Ôºâ</div>
                <br>
                <button class="action-btn" onclick="nextQuestion()">Ê¨°„ÅÆÂïèÈ°å„Å∏</button>
            </div>
        </div>

        <div class="back-link" onclick="location.reload()">„Çø„Ç§„Éà„É´„Å´Êàª„Çã</div>
    </div>

    <div id="end-screen" class="screen">
        <h2 id="end-title">ÁµÇ‰∫ÜÔºÅ</h2>
        
        <div id="scored-end-area" style="display:none;">
            <p class="score-display" style="font-size:1.8rem; font-weight:bold; margin: 10px 0;">
                Ê≠£Ëß£Êï∞: <span id="final-score">0</span> / <span id="total-count">0</span>
            </p>
            <div id="feedback-comment" style="margin: 1.5rem 0; font-size:1.1rem;"></div>
        </div>

        <div id="party-end-area" style="display:none;">
            <p style="font-size:1.2rem;">ÂÖ®„Å¶„ÅÆÂïèÈ°å„ÅåÁµÇ„Çè„Çä„Åæ„Åó„ÅüÔºÅ</p>
            <p style="margin-bottom: 1.5rem; color:#666;">Ê•Ω„Åó„Çì„Åß„ÅÑ„Åü„Å†„Åë„Åæ„Åó„Åü„ÅãÔºü</p>
        </div>

        <button class="action-btn" onclick="location.reload()">„Çø„Ç§„Éà„É´„Å´Êàª„Çã</button>
    </div>
</div>

<script>
    /* --- Èü≥Â£∞Âá¶ÁêÜ (Web Audio API) --- */
    let audioCtx;
    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    function playSound(type) {
        if (!audioCtx) return;
        const now = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();

        if (type === 'correct') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(880, now);
            osc.frequency.setValueAtTime(1760, now + 0.1);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.4);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(now); osc.stop(now + 0.4);
        } else if (type === 'wrong') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.linearRampToValueAtTime(100, now + 0.3);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.3);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(now); osc.stop(now + 0.3);
        }
    }

    /* --- Â§ßÁõõ„ÇäÂïèÈ°å„Éá„Éº„Çø --- */
    const masterQuizData = [
        // === Level 1: ÂàùÁ¥ö„ÉªÊó•Â∏∏ÁöÑ ===
        { abbr: "„Çπ„Éû„Éõ", formal: ["„Çπ„Éû„Éº„Éà„Éï„Ç©„É≥", "„Çπ„Éû„Éº„Éà„Éõ„É≥"], level: 1 },
        { abbr: "„Éë„ÇΩ„Ç≥„É≥", formal: ["„Éë„Éº„ÇΩ„Éä„É´„Ç≥„É≥„Éî„É•„Éº„Çø", "„Éë„Éº„ÇΩ„Éä„É´„Ç≥„É≥„Éî„É•„Éº„Çø„Éº"], level: 1 },
        { abbr: "„Ç≥„É≥„Éì„Éã", formal: ["„Ç≥„É≥„Éì„Éã„Ç®„É≥„Çπ„Çπ„Éà„Ç¢"], level: 1 },
        { abbr: "„ÉÜ„É¨„Éì", formal: ["„ÉÜ„É¨„Éì„Ç∏„Éß„É≥"], level: 1 },
        { abbr: "„É™„É¢„Ç≥„É≥", formal: ["„É™„É¢„Éº„Éà„Ç≥„É≥„Éà„É≠„Éº„É©„Éº"], level: 1 },
        { abbr: "„Ç®„Ç¢„Ç≥„É≥", formal: ["„Ç®„Ç¢„Éº„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„Éä„Éº"], level: 1 },
        { abbr: "„Ç¢„Éã„É°", formal: ["„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥"], level: 1 },
        { abbr: "„Éá„Éë„Éº„Éà", formal: ["„Éá„Éë„Éº„Éà„É°„É≥„Éà„Çπ„Éà„Ç¢"], level: 1 },
        { abbr: "„Çπ„Éº„Éë„Éº", formal: ["„Çπ„Éº„Éë„Éº„Éû„Éº„Ç±„ÉÉ„Éà"], level: 1 },
        { abbr: "„Éê„Ç§„Éà", formal: ["„Ç¢„É´„Éê„Ç§„Éà"], level: 1 },
        { abbr: "„Éì„É´", formal: ["„Éì„É´„Éá„Ç£„É≥„Ç∞"], level: 1 },
        { abbr: "„Éû„Ç§„ÇØ", formal: ["„Éû„Ç§„ÇØ„É≠„Éï„Ç©„É≥"], level: 1 },
        { abbr: "„Éî„Ç¢„Éé", formal: ["„Éî„Ç¢„Éé„Éï„Ç©„É´„ÉÜ", "„ÇØ„É©„É¥„Ç£„ÉÅ„Çß„É≥„Éê„É≠„Éª„Ç≥„É´„Éª„Éî„Ç¢„Éé„Éª„Ç®„Éª„Éï„Ç©„É´„ÉÜ"], level: 1 },
        { abbr: "„É°„É¢", formal: ["„É°„É¢„É©„É≥„ÉÄ„É†"], level: 1 },
        { abbr: "„Éü„Çπ", formal: ["„Éü„Çπ„ÉÜ„Ç§„ÇØ"], level: 1 },
        { abbr: "„Éó„É≠", formal: ["„Éó„É≠„Éï„Çß„ÉÉ„Ç∑„Éß„Éä„É´"], level: 1 },
        { abbr: "„Ç¢„Éó„É™", formal: ["„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥"], level: 1 },
        { abbr: "„Ç§„É≥„Éï„É´", formal: ["„Ç§„É≥„Éï„É´„Ç®„É≥„Ç∂"], level: 1 },
        { abbr: "„Éà„Ç§„É¨", formal: ["„Éà„Ç§„É¨„ÉÉ„Éà"], level: 1 },

        // === Level 2: ‰∏≠Á¥ö„ÉªÊº¢Â≠ó„ÇÑÂ∞ë„ÅóÈï∑„ÅÑ„ÇÇ„ÅÆ ===
        { abbr: "È£ü„Éë„É≥", formal: ["‰∏ªÈ£üÁî®„Éë„É≥", "Êú¨È£ü„Éë„É≥"], level: 2 },
        { abbr: "ËªçÊâã", formal: ["ËªçÁî®ÊâãË¢ã"], level: 2 },
        { abbr: "ÂàáÊâã", formal: ["ÂàáÁ¨¶ÊâãÂΩ¢"], level: 2 },
        { abbr: "ÁµåÊ∏à", formal: ["Áµå‰∏ñÊ∏àÊ∞ë"], level: 2 },
        { abbr: "ÊïôÁßëÊõ∏", formal: ["ÊïôÁßëÁî®Âõ≥Êõ∏"], level: 2 },
        { abbr: "„Éú„Éº„É´„Éö„É≥", formal: ["„Éú„Éº„É´„Éù„Ç§„É≥„Éà„Éö„É≥"], level: 2 },
        { abbr: "„Ç∑„É£„Éº„Éö„É≥", formal: ["„Ç∑„É£„Éº„Éó„Éö„É≥„Ç∑„É´"], level: 2 },
        { abbr: "ÊºîÊ≠å", formal: ["ÊºîË™¨Ê≠å"], level: 2 },
        { abbr: "Ââ≤„ÇäÂãò", formal: ["Ââ≤ÂâçÂãòÂÆö"], level: 2 },
        { abbr: "Êñ≠„Éà„ÉÑ", formal: ["Êñ≠ÁÑ∂„Éà„ÉÉ„Éó"], level: 2 },
        { abbr: "ÁâπÊÄ•", formal: ["ÁâπÂà•ÊÄ•Ë°å"], level: 2 },
        { abbr: "Â≠¶Ââ≤", formal: ["Â≠¶ÁîüÂâ≤Âºï"], level: 2 },
        { abbr: "ÂõΩÈÄ£", formal: ["ÂõΩÈöõÈÄ£Âêà"], level: 2 },
        { abbr: "Ëæ≤Âçî", formal: ["Ëæ≤Ê•≠ÂçîÂêåÁµÑÂêà"], level: 2 },
        { abbr: "‰∏áÂπ¥Á≠Ü", formal: ["‰∏áÂπ¥Á≠Ü"], level: 2 }, // ‚Äª„Å≤„Å£„Åã„ÅëÁî®ÔºàÂÆü„ÅØÁï•Ë™û„Åß„ÅØ„Å™„ÅÑË™¨„ÇÇ„ÅÇ„Çã„Åå„ÄÅ‰∏áÂπ¥Á≠Ü„ÅØ„Åù„ÅÆ„Åæ„ÅæÔºâ‚Ä¶‰ªäÂõû„ÅØÈô§Â§ñ„Åã„ÄÅ„ÅÇ„Çã„ÅÑ„ÅØ„Äå„Éû„É≥„Éç„É≥„Éí„ÉÑ„ÄçËá™‰Ωì„ÅåÊ≠£ÂºèÂêçÁß∞„ÄÇ„ÇØ„Ç§„Ç∫„Å®„Åó„Å¶„ÅØ„ÄåÁï•Ë™û„Åß„ÅØ„Å™„ÅÑ„Äç„ÇÇÈù¢ÁôΩ„ÅÑ„Åå„ÄÅ‰ªäÂõû„ÅØÁï•Ë™û„ÇØ„Ç§„Ç∫„Å™„ÅÆ„ÅßÂÖ•„ÇåÊõø„Åà„Åæ„Åô‚Üì
        { abbr: "‰∫§Áï™", formal: ["‰∫§Áï™ÊâÄ"], level: 2 },
        { abbr: "Â∞±Ê¥ª", formal: ["Â∞±ËÅ∑Ê¥ªÂãï"], level: 2 },
        { abbr: "Â©öÊ¥ª", formal: ["ÁµêÂ©öÊ¥ªÂãï"], level: 2 },
        { abbr: "„Éñ„É≠„Ç∞", formal: ["„Ç¶„Çß„Éñ„É≠„Ç∞"], level: 2 },
        { abbr: "„É™„Çπ„Éà„É©", formal: ["„É™„Çπ„Éà„É©„ÇØ„ÉÅ„É£„É™„É≥„Ç∞"], level: 2 },
        { abbr: "„Çª„ÇØ„Éè„É©", formal: ["„Çª„ÇØ„Ç∑„É£„É´„Éè„É©„Çπ„É°„É≥„Éà"], level: 2 },
        
        // === Level 3: ‰∏äÁ¥ö„ÉªËã±Ë™ûÈ†≠ÊñáÂ≠ó„ÉªÈõ£Âïè ===
        { abbr: "„Ç´„É©„Ç™„Ç±", formal: ["Á©∫„Ç™„Éº„Ç±„Çπ„Éà„É©"], level: 3 },
        { abbr: "„Éâ„Çø„Ç≠„É£„É≥", formal: ["ÂúüÂ£áÂ†¥„Ç≠„É£„É≥„Çª„É´"], level: 3 },
        { abbr: "„É¨„Éº„ÉÄ„Éº", formal: ["ÈõªÊ≥¢Êé¢Áü•Ê©ü", "„É©„Ç∏„Ç™„Éá„Ç£„ÉÜ„ÇØ„Ç∑„Éß„É≥„Ç¢„É≥„Éâ„É¨„É≥„Ç∏„É≥„Ç∞"], level: 3 },
        { abbr: "„É¨„Éº„Ç∂„Éº", formal: ["Light Amplification by Stimulated Emission of Radiation", "Ë™òÂ∞éÊîæÂá∫„Å´„Çà„ÇãÂÖâÂ¢óÂπÖÊîæÂ∞Ñ"], level: 3 },
        { abbr: "„Çπ„Ç≠„É•„Éº„Éê", formal: ["Self-Contained Underwater Breathing Apparatus", "Ëá™Áµ¶ÂºèÊ∞¥‰∏≠ÂëºÂê∏Ë£ÖÁΩÆ"], level: 3 },
        { abbr: "USB", formal: ["„É¶„Éã„Éê„Éº„Çµ„É´„Éª„Ç∑„É™„Ç¢„É´„Éª„Éê„Çπ"], level: 3 },
        { abbr: "Wi-Fi", formal: ["„ÉØ„Ç§„É§„É¨„Çπ„Éª„Éï„Ç£„Éá„É™„ÉÜ„Ç£", "Wireless Fidelity"], level: 3 },
        { abbr: "DVD", formal: ["„Éá„Ç∏„Çø„É´„Éª„Éê„Éº„Çµ„Çø„Ç§„É´„Éª„Éá„Ç£„Çπ„ÇØ"], level: 3 },
        { abbr: "GPS", formal: ["„Ç∞„É≠„Éº„Éê„É´„Éª„Éù„Ç∏„Ç∑„Éß„Éã„É≥„Ç∞„Éª„Ç∑„Çπ„ÉÜ„É†", "ÂÖ®Âú∞ÁêÉÊ∏¨‰Ωç„Ç∑„Çπ„ÉÜ„É†"], level: 3 },
        { abbr: "IQ", formal: ["„Ç§„É≥„ÉÜ„É™„Ç∏„Çß„É≥„Çπ„Éª„ÇØ„Ç©„Éº„Ç∑„Çß„É≥„Éà", "Áü•ËÉΩÊåáÊï∞"], level: 3 },
        { abbr: "SOS", formal: ["Save Our Souls", "Save Our Ship", "ÈÅ≠Èõ£‰ø°Âè∑"], level: 3 },
        { abbr: "VIP", formal: ["„Éô„É™„Éº„Éª„Ç§„É≥„Éù„Éº„Çø„É≥„Éà„Éª„Éë„Éº„ÇΩ„É≥", "Ë¶Å‰∫∫"], level: 3 },
        { abbr: "ATM", formal: ["„Ç™„Éº„Éà„É°„Ç§„ÉÜ„ÉÉ„Éâ„Éª„ÉÜ„É©„Éº„Éª„Éû„Ç∑„É≥", "ÁèæÈáëËá™ÂãïÈ†ê„ÅëÊâï„ÅÑÊ©ü"], level: 3 },
        { abbr: "CEO", formal: ["„ÉÅ„Éº„Éï„Éª„Ç®„Ç∞„Çº„ÇØ„ÉÜ„Ç£„Éñ„Éª„Ç™„Éï„Ç£„Çµ„Éº", "ÊúÄÈ´òÁµåÂñ∂Ë≤¨‰ªªËÄÖ"], level: 3 },
        { abbr: "NG", formal: ["„Éé„Éº„Ç∞„ÉÉ„Éâ"], level: 3 },
        { abbr: "CM", formal: ["„Ç≥„Éû„Éº„Ç∑„É£„É´„É°„ÉÉ„Çª„Éº„Ç∏"], level: 3 },
        { abbr: "„ÉØ„Ç§„Ç∑„É£„ÉÑ", formal: ["„Éõ„ÉØ„Ç§„Éà„Ç∑„É£„ÉÑ"], level: 3 },
        { abbr: "„Ç¨„Éì„Éß„Ç¶", formal: ["ÁîªÈã≤"], level: 3 }, // ÂÆü„ÅØ„ÄåÁîªÈã≤„Äç„ÅØÊ≠£ÂºèÂêçÁß∞„ÄÇÂÖ•„ÇåÊõø„Åà‚Üì
        { abbr: "„ÇΩ„Éï„Éà„ÇØ„É™„Éº„É†", formal: ["„ÇΩ„Éï„Éà„Çµ„Éº„Éñ„Ç¢„Ç§„Çπ„ÇØ„É™„Éº„É†"], level: 3 },
        { abbr: "„ÉØ„ÉÉ„Éö„É≥", formal: ["WappenÔºà„Éâ„Ç§„ÉÑË™ûÔºâ"], level: 3 },
        { abbr: "„Éö„Éö„É≠„É≥„ÉÅ„Éº„Éé", formal: ["„Ç¢„Éº„É™„Ç™„Éª„Ç™„Éº„É™„Ç™„Éª„Ç®„Éª„Éö„Éö„É≠„É≥„ÉÅ„Éº„Éé"], level: 3 }
    ];

    /* --- „Ç≤„Éº„É†Áä∂ÊÖãÁÆ°ÁêÜ --- */
    let currentMode = ''; 
    let currentQuestionIndex = 0;
    let score = 0;
    let activeQuestionList = []; 

    // DOMË¶ÅÁ¥†
    const menuScreen = document.getElementById('menu-screen');
    const gameScreen = document.getElementById('game-screen');
    const endScreen = document.getElementById('end-screen');
    const progressBar = document.getElementById('progress-bar');
    const questionText = document.getElementById('question-text');
    const levelBadge = document.getElementById('level-badge');

    const choiceArea = document.getElementById('choice-area');
    const soloArea = document.getElementById('solo-area');
    const partyArea = document.getElementById('party-area');

    const choicesContainer = document.getElementById('choices-container');
    const answerInput = document.getElementById('answer-input');
    const soloSubmitBtn = document.getElementById('solo-submit-btn');

    const commonResultArea = document.getElementById('common-result-area');
    const resultMessage = document.getElementById('result-message');
    const commonCorrectText = document.getElementById('common-correct-text');

    const partyRevealBtn = document.getElementById('party-reveal-btn');
    const partyAnswerBox = document.getElementById('party-answer-box');
    const partyCorrectText = document.getElementById('party-correct-text');
    const partyAltText = document.getElementById('party-alt-text');

    // ÈÖçÂàó„Çí„Ç∑„É£„ÉÉ„Éï„É´„Åô„ÇãÈñ¢Êï∞
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // ÂïèÈ°å„É™„Çπ„Éà„ÇíÁîüÊàêÔºà„É¨„Éô„É´„Åî„Å®„Å´„Ç∑„É£„ÉÉ„Éï„É´„Åó„Å¶ÁµêÂêàÔºâ
    function generateActiveQuestionList() {
        // Ê∑±„ÅÑ„Ç≥„Éî„Éº„Çí„Åó„Å¶ÂÖÉ„ÅÆÈÖçÂàó„ÇíÂ£ä„Åï„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã
        const level1 = JSON.parse(JSON.stringify(masterQuizData.filter(q => q.level === 1)));
        const level2 = JSON.parse(JSON.stringify(masterQuizData.filter(q => q.level === 2)));
        const level3 = JSON.parse(JSON.stringify(masterQuizData.filter(q => q.level === 3)));

        // ÂêÑ„É¨„Éô„É´ÂÜÖ„Åß„Ç∑„É£„ÉÉ„Éï„É´
        shuffleArray(level1);
        shuffleArray(level2);
        shuffleArray(level3);

        // Êòì„Åó„ÅÑÈ†Ü„Å´ÁµêÂêà
        return [...level1, ...level2, ...level3];
    }

    // „É¢„Éº„ÉâÈÅ∏Êäû
    function selectMode(mode) {
        initAudio();
        currentMode = mode;
        currentQuestionIndex = 0;
        score = 0;
        
        activeQuestionList = generateActiveQuestionList();

        menuScreen.classList.remove('active');
        gameScreen.classList.add('active');

        choiceArea.style.display = (mode === 'choice') ? 'block' : 'none';
        soloArea.style.display = (mode === 'solo') ? 'block' : 'none';
        partyArea.style.display = (mode === 'party') ? 'block' : 'none';
        
        showQuestion();
    }

    // ÂïèÈ°åË°®Á§∫
    function showQuestion() {
        const q = activeQuestionList[currentQuestionIndex];
        questionText.textContent = q.abbr;
        
        // „É¨„Éô„É´„Éê„ÉÉ„Ç∏„ÅÆÊõ¥Êñ∞
        levelBadge.textContent = "LEVEL " + q.level;
        if(q.level === 1) levelBadge.style.backgroundColor = "#27ae60"; 
        else if(q.level === 2) levelBadge.style.backgroundColor = "#e67e22"; 
        else levelBadge.style.backgroundColor = "#e74c3c"; 
        
        const progress = ((currentQuestionIndex) / activeQuestionList.length) * 100;
        progressBar.style.width = `${progress}%`;

        commonResultArea.style.display = "none";

        if (currentMode === 'choice') {
            setupChoiceMode(q);
        } else if (currentMode === 'solo') {
            setupSoloMode();
        } else {
            setupPartyMode();
        }
        
        window.scrollTo(0, 0);
    }

    // --- 4Êäû„É¢„Éº„Éâ ---
    function setupChoiceMode(currentQ) {
        choicesContainer.innerHTML = ''; 
        const correctAnswer = currentQ.formal[0];
        
        // „ÉÄ„Éü„ÉºÈÅ∏ÊäûËÇ¢ÔºöÂÖ®ÂïèÈ°å„ÅÆ‰∏≠„Åã„Çâ„ÄÅÊ≠£Ëß£‰ª•Â§ñ„ÅÆÊ≠£ÂºèÂêçÁß∞„Çí„É©„É≥„ÉÄ„É†„Å´3„Å§ÈÅ∏„Å∂
        const allFormalAnswers = masterQuizData
            .map(d => d.formal[0])
            .filter(a => a !== correctAnswer);
        
        const shuffledOthers = shuffleArray([...allFormalAnswers]);
        const dummyAnswers = shuffledOthers.slice(0, 3);
        
        let choices = [correctAnswer, ...dummyAnswers];
        choices = shuffleArray(choices);

        choices.forEach(choiceText => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.textContent = choiceText;
            btn.onclick = () => checkChoiceAnswer(choiceText, btn, correctAnswer);
            choicesContainer.appendChild(btn);
        });
    }

    function checkChoiceAnswer(selectedText, clickedBtn, correctAnswer) {
        const buttons = choicesContainer.getElementsByClassName('choice-btn');
        for (let btn of buttons) {
            btn.disabled = true;
            if (btn.textContent === correctAnswer) {
                btn.classList.add('correct-choice');
            }
        }
        const isCorrect = (selectedText === correctAnswer);
        if (isCorrect) score++;
        else clickedBtn.classList.add('wrong-choice');
        
        showCommonResult(isCorrect, correctAnswer);
    }

    // --- „Å≤„Å®„Çä„É¢„Éº„Éâ ---
    function setupSoloMode() {
        answerInput.value = "";
        answerInput.disabled = false;
        soloSubmitBtn.style.display = "inline-block";
        setTimeout(() => answerInput.focus(), 100);
    }

    function normalizeString(str) {
        return str.replace(/[\s„ÄÄ„Éª]/g, "")
                  .replace(/[„ÅÅ-„Çì]/g, s => String.fromCharCode(s.charCodeAt(0) + 0x60))
                  .toLowerCase(); // „Ç¢„É´„Éï„Ç°„Éô„ÉÉ„Éà„ÅÆÂ§ßÊñáÂ≠óÂ∞èÊñáÂ≠ó„ÇíÂå∫Âà•„Åó„Å™„ÅÑ
    }

    function checkSoloAnswer() {
        const userAnswer = normalizeString(answerInput.value);
        const correctAnswers = activeQuestionList[currentQuestionIndex].formal;
        let isCorrect = false;
        for (let ans of correctAnswers) {
            if (userAnswer === normalizeString(ans)) {
                isCorrect = true; break;
            }
        }
        answerInput.disabled = true;
        soloSubmitBtn.style.display = "none";
        showCommonResult(isCorrect, correctAnswers[0]);
    }

    // --- ÂÖ±ÈÄöÁµêÊûúË°®Á§∫ ---
    function showCommonResult(isCorrect, mainCorrectAnswer) {
        commonResultArea.style.display = "block";
        commonCorrectText.textContent = mainCorrectAnswer;

        if (isCorrect) {
            resultMessage.textContent = "Ê≠£Ëß£ÔºÅ‚≠ïÔ∏è";
            resultMessage.className = "correct";
            playSound('correct');
        } else {
            resultMessage.textContent = "ÊÆãÂøµ...‚ùå";
            resultMessage.className = "incorrect";
            playSound('wrong');
        }
    }

    // --- „Åø„Çì„Å™„É¢„Éº„Éâ ---
    function setupPartyMode() {
        partyRevealBtn.style.display = "inline-block";
        partyAnswerBox.style.display = "none";
    }

    function revealPartyAnswer() {
        const q = activeQuestionList[currentQuestionIndex];
        partyCorrectText.textContent = q.formal[0];
        if (q.formal.length > 1) {
            partyAltText.textContent = q.formal.slice(1).join(', ');
            partyAltText.parentNode.style.display = "block";
        } else {
            partyAltText.parentNode.style.display = "none";
        }
        partyRevealBtn.style.display = "none";
        partyAnswerBox.style.display = "block";
        playSound('correct');
    }

    // --- ÈÄ≤Ë°å„ÉªÁµÇ‰∫Ü ---
    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < activeQuestionList.length) {
            showQuestion();
        } else {
            showEndScreen();
        }
    }

    function showEndScreen() {
        gameScreen.classList.remove('active');
        endScreen.classList.add('active');

        if (currentMode === 'choice' || currentMode === 'solo') {
            document.getElementById('scored-end-area').style.display = 'block';
            document.getElementById('party-end-area').style.display = 'none';
            document.getElementById('final-score').textContent = score;
            document.getElementById('total-count').textContent = activeQuestionList.length;
            
            const feedback = document.getElementById('feedback-comment');
            const rate = score / activeQuestionList.length;
            
            if (score === activeQuestionList.length) feedback.textContent = "Á•û„É¨„Éô„É´ÔºÅÈõëÂ≠¶Áéã„Åß„Åô„Å≠ÔºÅüëë‚ú®";
            else if (rate >= 0.8) feedback.textContent = "„Åô„Åî„ÅÑÔºÅ„Åã„Å™„Çä„ÅÆÁâ©Áü•„Çä„Åß„Åôüëè";
            else if (rate >= 0.6) feedback.textContent = "„Å™„Åã„Å™„Åã„ÅÆÂ•ΩÊàêÁ∏æ„Åß„ÅôÔºÅüëç";
            else if (rate >= 0.4) feedback.textContent = "„Åæ„ÅÇ„Åæ„ÅÇ„Åß„Åô„Å≠ÔºÅ‰øÆË°å„ÅÇ„Çã„ÅÆ„ÅøÔºÅüî•";
            else feedback.textContent = "‰º∏„Å≥‰ª£„Åå„ÅÇ„Çä„Åæ„Åô„Å≠...ÔºÅüå±";
        } else {
            document.getElementById('scored-end-area').style.display = 'none';
            document.getElementById('party-end-area').style.display = 'block';
        }
    }

    answerInput.addEventListener("keypress", function(event) {
        if (currentMode === 'solo' && event.key === "Enter") {
            if (soloSubmitBtn.style.display !== "none") {
                checkSoloAnswer();
            } else if (commonResultArea.style.display !== "none") {
                nextQuestion();
            }
        }
    });

</script>

</body>
</html>
