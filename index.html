<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç•¥èªæ­£å¼åç§°ã‚¯ã‚¤ã‚ºï¼ˆå®Œå…¨ç‰ˆï¼‰</title>
    <style>
        /* --- ãƒ™ãƒ¼ã‚¹è¨­å®š --- */
        :root {
            --primary-color: #3498db; --bg-color: #f0f4f8; --text-color: #333;
            --success-color: #27ae60; --error-color: #e74c3c;
            --gal-primary: #ff69b4; --gal-bg: #fff0f5;
            --police-primary: #2c3e50; --police-bg: #e8ecef;
            --biz-primary: #0047AB; --biz-bg: #f5f7fa;
            --otaku-primary: #9b59b6; --otaku-bg: #f3e5f5;
            --medical-primary: #16a085; --medical-bg: #e8f8f5;
            --netslang-primary: #e67e22; --netslang-bg: #fdf2e9;
            --sumo-primary: #8d6e63; --sumo-bg: #efebe9;
        }
        * { box-sizing: border-box; }
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; padding: 10px;
            user-select: none; -webkit-tap-highlight-color: transparent;
            transition: background-color 0.5s;
        }

        /* ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        body.gal-mode { background-color: var(--gal-bg); --primary-color: var(--gal-primary); }
        body.police-mode { background-color: var(--police-bg); --primary-color: var(--police-primary); }
        body.biz-mode { background-color: var(--biz-bg); --primary-color: var(--biz-primary); }
        body.otaku-mode { background-color: var(--otaku-bg); --primary-color: var(--otaku-primary); }
        body.medical-mode { background-color: var(--medical-bg); --primary-color: var(--medical-primary); }
        body.netslang-mode { background-color: var(--netslang-bg); --primary-color: var(--netslang-primary); }
        body.sumo-mode { background-color: var(--sumo-bg); --primary-color: var(--sumo-primary); }

        .container {
            background-color: white; padding: 2rem; border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 500px;
            text-align: center; position: relative;
        }

        h1 { color: #2c3e50; margin-bottom: 0.5rem; font-size: 1.5rem; }
        .subtitle { color: #7f8c8d; font-size: 0.9rem; margin-bottom: 1.5rem; }
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ãƒœã‚¿ãƒ³ */
        .menu-btn {
            display: flex; align-items: center; justify-content: space-between;
            width: 100%; margin: 8px 0; padding: 1rem; font-size: 1rem;
            border-radius: 12px; border: none; cursor: pointer;
            transition: transform 0.1s; font-weight: bold; color: white;
            text-align: left; box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        .menu-btn:active { transform: translateY(4px); box-shadow: none; }
        .menu-desc { font-size: 0.75rem; font-weight: normal; display:block; opacity:0.9; }

        .btn-std { background-color: #3498db; }
        .btn-police { background-color: #2c3e50; border-left: 5px solid #f1c40f; }
        .btn-biz { background-color: #0047AB; }
        .btn-otaku { background-color: #9b59b6; }
        .btn-gal { background-color: #ff69b4; }
        .btn-medical { background-color: #16a085; }
        .btn-netslang { background-color: #e67e22; }
        .btn-sumo { background-color: #8d6e63; border-left: 5px solid #000; }

        .play-mode-selector { display: flex; gap: 8px; margin-bottom: 15px; justify-content: center; }
        .play-mode-btn {
            padding: 8px 14px; border: 1px solid #ccc; border-radius: 20px;
            background: white; cursor: pointer; font-size: 0.85rem;
        }
        .play-mode-btn.selected { background: var(--primary-color); color: white; border-color: var(--primary-color); }

        .era-btn {
            width: 100%; margin: 5px 0; padding: 0.8rem; font-size: 0.9rem;
            border-radius: 50px; border: 2px solid #ff69b4;
            background: white; color: #ff69b4; font-weight: bold; cursor: pointer;
        }

        .question-box {
            background-color: #eef2f7; padding: 1.5rem; border-radius: 10px;
            margin-bottom: 1.5rem; min-height: 140px; display: flex;
            flex-direction: column; justify-content: center; align-items: center; position: relative;
        }
        .badge {
            position: absolute; top: -10px; right: 10px; color: #fff;
            padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .abbr-text { font-size: 2.0rem; font-weight: bold; color: var(--primary-color); margin: 0; line-height: 1.2; }

        .choices-container { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .choice-btn {
            background-color: white; border: 2px solid #bdc3c7; color: #333;
            padding: 14px; font-size: 0.95rem; border-radius: 10px;
            cursor: pointer; font-weight: bold; transition: all 0.2s;
            overflow-wrap: break-word; word-wrap: break-word;
        }
        .choice-btn.correct-choice { background-color: #27ae60 !important; color: white !important; border-color: #27ae60 !important; }
        .choice-btn.wrong-choice { background-color: #e74c3c !important; color: white !important; border-color: #e74c3c !important; }

        .action-btn {
            background-color: var(--primary-color); color: white; border: none;
            padding: 14px 20px; font-size: 1.1rem; border-radius: 50px;
            cursor: pointer; font-weight: bold; width: 100%; max-width: 300px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2); margin-top: 10px;
        }
        .action-btn:active { transform: translateY(4px); box-shadow: none; }

        input[type="text"] {
            width: 100%; padding: 14px; font-size: 1.2rem; border: 2px solid #ddd;
            border-radius: 8px; margin-bottom: 1rem; text-align: center; outline: none;
        }
        
        .result-box {
            background: #fafafa; padding: 20px; border-radius: 10px;
            margin-top: 10px; text-align: center; border: 1px solid #eee; display: none;
        }
        #result-msg { font-size: 1.6rem; font-weight: bold; margin: 0.5rem 0; }
        .correct { color: #27ae60; } .incorrect { color: #e74c3c; }

        .progress-bar { width: 100%; background: #eee; height: 6px; border-radius: 3px; margin-bottom: 1.5rem; overflow: hidden; }
        .progress-fill { height: 100%; background: #27ae60; width: 0%; transition: width 0.3s; }
        .back-link { display: inline-block; margin-top: 25px; color: #999; text-decoration: underline; cursor: pointer; padding: 10px; }

        @media (max-width: 480px) {
            .container { padding: 1.5rem 1rem; }
            h1 { font-size: 1.3rem; }
            .abbr-text { font-size: 1.6rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1 id="app-title">ç•¥èªæ­£å¼åç§°ã‚¯ã‚¤ã‚º</h1>
    <p class="subtitle">å®Œå…¨ç‰ˆï¼ç„¡é™ã«éŠã¹ã‚‹ã‚ˆ</p>

    <div id="menu-screen" class="screen active">
        
        <div style="margin-bottom: 15px; border-bottom:1px solid #eee; padding-bottom:10px;">
            <p style="font-size:0.8rem; color:#666; margin-bottom:5px;">éŠã³æ–¹</p>
            <div class="play-mode-selector">
                <button class="play-mode-btn selected" onclick="setPlayMode('choice', this)">ğŸ¤” 4æŠ</button>
                <button class="play-mode-btn" onclick="setPlayMode('solo', this)">âŒ¨ï¸ å…¥åŠ›</button>
                <button class="play-mode-btn" onclick="setPlayMode('party', this)">ğŸ—£ï¸ ã¿ã‚“ãª</button>
            </div>
        </div>

        <div style="height: 320px; overflow-y: auto; padding-right: 5px;">
            
            <p style="font-size:0.9rem; font-weight:bold; margin:15px 0 5px;">ã‚³ãƒ¼ã‚¹é¸æŠ</p>

            <button class="menu-btn btn-std" onclick="startSpecialGame('std')">
                <div class="menu-btn-content"><span>ğŸ“˜ ä¸€èˆ¬å¸¸è­˜</span><span class="menu-desc">ãƒ¬ãƒ™ãƒ«é †ã«å‡ºé¡Œ</span></div><span>â–¶</span>
            </button>
            <button class="menu-btn btn-police" onclick="startSpecialGame('police')">
                <div class="menu-btn-content"><span>ğŸ‘® è­¦å¯Ÿãƒ»åˆ‘äº‹</span><span class="menu-desc">ãƒ‡ã‚«ã€ã‚¬ã‚µå…¥ã‚Œ...</span></div><span>â–¶</span>
            </button>
            <button class="menu-btn btn-biz" onclick="startSpecialGame('biz')">
                <div class="menu-btn-content"><span>ğŸ’¼ ãƒ“ã‚¸ãƒã‚¹ãƒ»IT</span><span class="menu-desc">MTGã€ã‚¢ã‚¸ã‚§ãƒ³ãƒ€...</span></div><span>â–¶</span>
            </button>
            <button class="menu-btn btn-otaku" onclick="startSpecialGame('otaku')">
                <div class="menu-btn-content"><span>ğŸ¤“ ã‚ªã‚¿ã‚¯ãƒ»æ¨ã—æ´»</span><span class="menu-desc">å°Šã„ã€åŒæ‹…...</span></div><span>â–¶</span>
            </button>
            <button class="menu-btn btn-gal" onclick="toggleGalMenu()">
                <div class="menu-btn-content"><span>ğŸ’– ã‚®ãƒ£ãƒ«èª</span><span class="menu-desc">æ˜­å’Œãƒ»å¹³æˆãƒ»ä»¤å’Œ</span></div><span>â–¼</span>
            </button>
            <button class="menu-btn btn-medical" onclick="startSpecialGame('medical')">
                <div class="menu-btn-content"><span>ğŸ¥ åŒ»ç™‚ãƒ»ç—…é™¢</span><span class="menu-desc">ã‚«ãƒ«ãƒ†ã€ã‚ªãƒš...</span></div><span>â–¶</span>
            </button>
            <button class="menu-btn btn-netslang" onclick="startSpecialGame('netslang')">
                <div class="menu-btn-content"><span>ğŸ’» ãƒãƒƒãƒˆã‚¹ãƒ©ãƒ³ã‚°</span><span class="menu-desc">wã€é¯–è½ã¡...</span></div><span>â–¶</span>
            </button>
            <button class="menu-btn btn-sumo" onclick="startSpecialGame('sumo')">
                <div class="menu-btn-content"><span>âœ‹ ç›¸æ’²ãƒ»è§’ç•Œ</span><span class="menu-desc">é‡‘æ˜Ÿã€ã‚¿ãƒ‹ãƒãƒ...</span></div><span>â–¶</span>
            </button>
            
            <div id="gal-era-select" style="display:none; margin-top:5px;">
                <button class="era-btn" onclick="startGalGame('showa')">ğŸ“¼ æ˜­å’Œã‚®ãƒ£ãƒ«</button>
                <button class="era-btn" onclick="startGalGame('heisei')">ğŸŒº å¹³æˆã‚®ãƒ£ãƒ«</button>
                <button class="era-btn" onclick="startGalGame('reiwa')">ğŸ“± ä»¤å’Œã‚®ãƒ£ãƒ«</button>
            </div>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
        
        <div class="question-box">
            <div id="info-badge" class="badge" style="background:#ccc;">CATEGORY</div>
            <span class="label">ã“ã‚Œã®æ­£å¼åç§°ï¼ˆæ„å‘³ï¼‰ã¯ï¼Ÿ</span>
            <div id="question-text" class="abbr-text"></div>
        </div>

        <div id="choice-area" style="display:none;">
            <div id="choices-container" class="choices-container"></div>
        </div>

        <div id="solo-area" style="display:none;">
            <input type="text" id="answer-input" placeholder="ã“ã“ã«å…¥åŠ›..." autocomplete="off">
            <br>
            <button id="solo-submit-btn" class="action-btn" onclick="checkSoloAnswer()">å›ç­”ã™ã‚‹</button>
        </div>

        <div id="result-area" class="result-box" style="display:none;">
            <div id="result-msg"></div>
            <div style="margin-top:10px;">æ­£è§£ã¯ï¼š<br><strong id="correct-text" style="font-size:1.3rem;"></strong></div>
            <button class="action-btn" onclick="nextQuestion()">æ¬¡ã¸é€²ã‚€</button>
        </div>

        <div id="party-area" style="display:none;">
            <button id="party-reveal-btn" class="action-btn" style="background-color:#e67e22;" onclick="revealPartyAnswer()">æ­£è§£ã‚’è¦‹ã‚‹</button>
            <div id="party-answer-box" style="display:none; margin:20px 0; border:2px dashed #ccc; padding:20px;">
                <div id="party-correct-text" style="font-size:1.6rem; font-weight:bold; color:#e74c3c;"></div>
                <div style="color:#777;">ï¼ˆä»–ï¼š<span id="party-alt-text"></span>ï¼‰</div>
                <br>
                <button class="action-btn" onclick="nextQuestion()">æ¬¡ã¸é€²ã‚€</button>
            </div>
        </div>

        <div class="back-link" onclick="location.reload()">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</div>
    </div>

    <div id="end-screen" class="screen">
        <h2>çµ‚äº†ï¼</h2>
        <div id="scored-end-area">
            <p style="font-size:1.5rem; font-weight:bold;">æ­£è§£æ•°: <span id="final-score">0</span> / <span id="total-count">0</span></p>
        </div>
        
        <button class="action-btn" onclick="location.reload()">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
    </div>
</div>

<script>
    let audioCtx;
    function initAudio() { if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); if(audioCtx.state==='suspended') audioCtx.resume(); }
    function playSound(type) {
        if(!audioCtx) return; const now=audioCtx.currentTime; const osc=audioCtx.createOscillator(); const gain=audioCtx.createGain();
        if(type==='correct'){ osc.type='sine'; osc.frequency.setValueAtTime(880,now); osc.frequency.setValueAtTime(1760,now+0.1); gain.gain.linearRampToValueAtTime(0,now+0.4); }
        else{ osc.type='sawtooth'; osc.frequency.setValueAtTime(150,now); gain.gain.linearRampToValueAtTime(0,now+0.3); }
        osc.connect(gain); gain.connect(audioCtx.destination); osc.start(now); osc.stop(now+0.4);
    }

    /* --- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆå¾©æ´»ï¼ˆå®Œå…¨ç‰ˆï¼‰ --- */
    const masterQuizData = [
        // STD
        { abbr: "ã‚¹ãƒãƒ›", formal: ["ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³"], type: 'std', level: 1 },
        { abbr: "ãƒ‘ã‚½ã‚³ãƒ³", formal: ["ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿"], type: 'std', level: 1 },
        { abbr: "ã‚³ãƒ³ãƒ“ãƒ‹", formal: ["ã‚³ãƒ³ãƒ“ãƒ‹ã‚¨ãƒ³ã‚¹ã‚¹ãƒˆã‚¢"], type: 'std', level: 1 },
        { abbr: "ãƒ†ãƒ¬ãƒ“", formal: ["ãƒ†ãƒ¬ãƒ“ã‚¸ãƒ§ãƒ³"], type: 'std', level: 1 },
        { abbr: "ãƒªãƒ¢ã‚³ãƒ³", formal: ["ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼"], type: 'std', level: 1 },
        { abbr: "ã‚¨ã‚¢ã‚³ãƒ³", formal: ["ã‚¨ã‚¢ãƒ¼ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒŠãƒ¼"], type: 'std', level: 1 },
        { abbr: "ã‚¢ãƒ‹ãƒ¡", formal: ["ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³"], type: 'std', level: 1 },
        { abbr: "ãƒ‡ãƒ‘ãƒ¼ãƒˆ", formal: ["ãƒ‡ãƒ‘ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚¹ãƒˆã‚¢"], type: 'std', level: 1 },
        { abbr: "ã‚¹ãƒ¼ãƒ‘ãƒ¼", formal: ["ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒãƒ¼ã‚±ãƒƒãƒˆ"], type: 'std', level: 1 },
        { abbr: "ãƒã‚¤ãƒˆ", formal: ["ã‚¢ãƒ«ãƒã‚¤ãƒˆ"], type: 'std', level: 1 },
        { abbr: "é£Ÿãƒ‘ãƒ³", formal: ["ä¸»é£Ÿç”¨ãƒ‘ãƒ³"], type: 'std', level: 2 },
        { abbr: "è»æ‰‹", formal: ["è»ç”¨æ‰‹è¢‹"], type: 'std', level: 2 },
        { abbr: "åˆ‡æ‰‹", formal: ["åˆ‡ç¬¦æ‰‹å½¢"], type: 'std', level: 2 },
        { abbr: "çµŒæ¸ˆ", formal: ["çµŒä¸–æ¸ˆæ°‘"], type: 'std', level: 2 },
        { abbr: "æ•™ç§‘æ›¸", formal: ["æ•™ç§‘ç”¨å›³æ›¸"], type: 'std', level: 2 },
        { abbr: "ãƒœãƒ¼ãƒ«ãƒšãƒ³", formal: ["ãƒœãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆãƒšãƒ³"], type: 'std', level: 2 },
        { abbr: "ã‚«ãƒ©ã‚ªã‚±", formal: ["ç©ºã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ©"], type: 'std', level: 3 },
        { abbr: "ãƒ‰ã‚¿ã‚­ãƒ£ãƒ³", formal: ["åœŸå£‡å ´ã‚­ãƒ£ãƒ³ã‚»ãƒ«"], type: 'std', level: 3 },
        { abbr: "ãƒ¬ãƒ¼ãƒ€ãƒ¼", formal: ["é›»æ³¢æ¢çŸ¥æ©Ÿ"], type: 'std', level: 3 },
        { abbr: "USB", formal: ["ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ãƒ»ã‚·ãƒªã‚¢ãƒ«ãƒ»ãƒã‚¹"], type: 'std', level: 3 },
        { abbr: "Wi-Fi", formal: ["Wireless Fidelity"], type: 'std', level: 3 },
        { abbr: "DVD", formal: ["ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»ãƒãƒ¼ã‚µã‚¿ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ã‚¹ã‚¯"], type: 'std', level: 3 },
        // POLICE
        { abbr: "ãƒ‡ã‚«", formal: ["åˆ‘äº‹"], type: 'police', level: 1 },
        { abbr: "ãƒ›ã‚·", formal: ["çŠ¯äºº"], type: 'police', level: 1 },
        { abbr: "ã‚¬ã‚µå…¥ã‚Œ", formal: ["å®¶å®…æœç´¢"], type: 'police', level: 1 },
        { abbr: "ãƒãƒ³ã‹ã‘", formal: ["è·å‹™è³ªå•"], type: 'police', level: 1 },
        { abbr: "ãƒãƒ«æš´", formal: ["çµ„ç¹”çŠ¯ç½ªå¯¾ç­–éƒ¨"], type: 'police', level: 2 },
        { abbr: "ã‚¬ã‚¤ã‚·ãƒ£", formal: ["è¢«å®³è€…"], type: 'police', level: 2 },
        { abbr: "ãƒ¤ã‚µ", formal: ["å®¶"], type: 'police', level: 2 },
        { abbr: "ã‚¿ã‚¿ã‚­", formal: ["å¼·ç›—"], type: 'police', level: 2 },
        { abbr: "å¸³å ´", formal: ["æœæŸ»æœ¬éƒ¨"], type: 'police', level: 3 },
        { abbr: "ç¾ç€", formal: ["ç¾å ´åˆ°ç€"], type: 'police', level: 3 },
        { abbr: "ã‚²ã‚½", formal: ["è¶³è·¡"], type: 'police', level: 3 },
        // BIZ
        { abbr: "MTG", formal: ["ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°"], type: 'biz', level: 1 },
        { abbr: "CEO", formal: ["æœ€é«˜çµŒå–¶è²¬ä»»è€…"], type: 'biz', level: 1 },
        { abbr: "NG", formal: ["No Good"], type: 'biz', level: 1 },
        { abbr: "ã‚¢ãƒ", formal: ["ã‚¢ãƒã‚¤ãƒ³ãƒˆãƒ¡ãƒ³ãƒˆ"], type: 'biz', level: 1 },
        { abbr: "OJT", formal: ["On-the-Job Training"], type: 'biz', level: 2 },
        { abbr: "PDCA", formal: ["Plan-Do-Check-Act"], type: 'biz', level: 2 },
        { abbr: "ASAP", formal: ["As Soon As Possible"], type: 'biz', level: 2 },
        { abbr: "ãƒªã‚¹ã‚±", formal: ["ãƒªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«"], type: 'biz', level: 2 },
        { abbr: "KGI", formal: ["é‡è¦ç›®æ¨™é”æˆæŒ‡æ¨™"], type: 'biz', level: 3 },
        { abbr: "KPI", formal: ["é‡è¦æ¥­ç¸¾è©•ä¾¡æŒ‡æ¨™"], type: 'biz', level: 3 },
        { abbr: "NR", formal: ["ç›´å¸°"], type: 'biz', level: 3 },
        { abbr: "ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹", formal: ["è¨¼æ‹ "], type: 'biz', level: 3 },
        // OTAKU
        { abbr: "BL", formal: ["ãƒœãƒ¼ã‚¤ã‚ºãƒ©ãƒ–"], type: 'otaku', level: 1 },
        { abbr: "å¢", formal: ["ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ"], type: 'otaku', level: 1 },
        { abbr: "æ¨ã—", formal: ["ã‚¤ãƒã‚ªã‚·ã®ãƒ¡ãƒ³ãƒãƒ¼"], type: 'otaku', level: 1 },
        { abbr: "DD", formal: ["èª°ã§ã‚‚å¤§å¥½ã"], type: 'otaku', level: 2 },
        { abbr: "åŒæ‹…", formal: ["åŒã˜æ‹…å½“"], type: 'otaku', level: 2 },
        { abbr: "ãƒªã‚¢ã‚¿ã‚¤", formal: ["ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ "], type: 'otaku', level: 2 },
        { abbr: "ã‚¹ãƒ‘ãƒãƒ£", formal: ["ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒãƒ£ãƒƒãƒˆ"], type: 'otaku', level: 2 },
        { abbr: "ROMå°‚", formal: ["Read Only Member"], type: 'otaku', level: 3 },
        { abbr: "FFå¤–", formal: ["ãƒ•ã‚©ãƒ­ãƒ¼ãƒ»ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼å¤–"], type: 'otaku', level: 3 },
        // GAL
        { abbr: "ãƒŠã‚¦ã„", formal: ["ç¾ä»£çš„"], type: 'gal', era: 'showa' },
        { abbr: "ãƒãƒ–ãƒ€ãƒ", formal: ["è¦ªå‹"], type: 'gal', era: 'showa' },
        { abbr: "ãƒ‰ãƒ­ãƒ³", formal: ["æ¶ˆãˆã‚‹"], type: 'gal', era: 'showa' },
        { abbr: "ãƒãƒ§ãƒ™ãƒªãƒ", formal: ["è¶…ãƒ™ãƒªãƒ¼ãƒãƒƒãƒ‰"], type: 'gal', era: 'heisei' },
        { abbr: "ãƒãƒ§ãƒ™ãƒªã‚°", formal: ["è¶…ãƒ™ãƒªãƒ¼ã‚°ãƒƒãƒ‰"], type: 'gal', era: 'heisei' },
        { abbr: "MK5", formal: ["ãƒã‚¸ã§ã‚­ãƒ¬ã‚‹5ç§’å‰"], type: 'gal', era: 'heisei' },
        { abbr: "KP", formal: ["ä¹¾æ¯"], type: 'gal', era: 'reiwa' },
        { abbr: "ã‚Š", formal: ["äº†è§£"], type: 'gal', era: 'reiwa' },
        { abbr: "ãƒ•ãƒ­ãƒªãƒ€", formal: ["é¢¨å‘‚å…¥ã‚‹ã‹ã‚‰é›¢è„±"], type: 'gal', era: 'reiwa' },
        // MEDICAL (åŒ»ç™‚)
        { abbr: "ã‚¤ãƒ³ãƒ•ãƒ«", formal: ["ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶"], type: 'medical', level: 1 },
        { abbr: "ãƒªãƒãƒ“ãƒª", formal: ["ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³"], type: 'medical', level: 1 },
        { abbr: "ã‚«ãƒ«ãƒ†", formal: ["è¨ºç™‚éŒ²"], type: 'medical', level: 1 },
        { abbr: "ã‚ªãƒš", formal: ["æ‰‹è¡“", "ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"], type: 'medical', level: 1 },
        { abbr: "ICU", formal: ["é›†ä¸­æ²»ç™‚å®¤"], type: 'medical', level: 2 },
        { abbr: "AED", formal: ["è‡ªå‹•ä½“å¤–å¼é™¤ç´°å‹•å™¨"], type: 'medical', level: 2 },
        { abbr: "MRI", formal: ["ç£æ°—å…±é³´ç”»åƒæ³•"], type: 'medical', level: 2 },
        { abbr: "QOL", formal: ["ç”Ÿæ´»ã®è³ª", "ã‚¯ã‚ªãƒªãƒ†ã‚£ãƒ»ã‚ªãƒ–ãƒ»ãƒ©ã‚¤ãƒ•"], type: 'medical', level: 2 },
        { abbr: "ã‚¢ãƒŠãƒ ãƒ", formal: ["æ—¢å¾€æ­´", "å•è¨º"], type: 'medical', level: 3 },
        { abbr: "ãƒã‚¤ã‚¿ãƒ«", formal: ["ç”Ÿå‘½å…†å€™", "ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³"], type: 'medical', level: 3 },
        { abbr: "ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹", formal: ["ç§‘å­¦çš„æ ¹æ‹ ", "è¨¼æ‹ "], type: 'medical', level: 3 },
        { abbr: "ã‚¹ãƒ†ã‚‹", formal: ["æ­»äº¡ã™ã‚‹"], type: 'medical', level: 3 },

        // NET SLANG (ãƒãƒƒãƒˆã‚¹ãƒ©ãƒ³ã‚°)
        { abbr: "SNS", formal: ["ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ»ã‚µãƒ¼ãƒ“ã‚¹"], type: 'netslang', level: 1 },
        { abbr: "ã‚¢ã‚«", formal: ["ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ"], type: 'netslang', level: 1 },
        { abbr: "DM", formal: ["ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"], type: 'netslang', level: 1 },
        { abbr: "w", formal: ["ç¬‘ã„", "ç¬‘"], type: 'netslang', level: 1 },
        { abbr: "kwsk", formal: ["è©³ã—ã"], type: 'netslang', level: 2 },
        { abbr: "wktk", formal: ["ãƒ¯ã‚¯ãƒ¯ã‚¯ãƒ†ã‚«ãƒ†ã‚«", "æœŸå¾…ã—ã¦ã„ã‚‹"], type: 'netslang', level: 2 },
        { abbr: "é¯–", formal: ["ã‚µãƒ¼ãƒãƒ¼"], type: 'netslang', level: 2 },
        { abbr: "BAN", formal: ["ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåœæ­¢", "ç¦æ­¢"], type: 'netslang', level: 2 },
        { abbr: "ggrks", formal: ["ã‚°ã‚°ã‚Œã‚«ã‚¹", "è‡ªåˆ†ã§æ¤œç´¢ã—ã‚"], type: 'netslang', level: 3 },
        { abbr: "ã†p", formal: ["ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"], type: 'netslang', level: 3 },
        { abbr: "ä¹™", formal: ["ãŠç–²ã‚Œæ§˜"], type: 'netslang', level: 3 },
        { abbr: "ã‚½ãƒ¼ã‚¹", formal: ["æƒ…å ±æº"], type: 'netslang', level: 3 },

        // SUMO (ç›¸æ’²æ¥­ç•Œ)
        { abbr: "å ´æ‰€", formal: ["æœ¬å ´æ‰€"], type: 'sumo', level: 1 },
        { abbr: "é–¢å–", formal: ["åä¸¡ä»¥ä¸Šã®åŠ›å£«"], type: 'sumo', level: 1 },
        { abbr: "è¦ªæ–¹", formal: ["å¹´å¯„", "å¸«åŒ "], type: 'sumo', level: 1 },
        { abbr: "æ¨ªç¶±", formal: ["æœ€é«˜ä½ã®åŠ›å£«"], type: 'sumo', level: 1 },
        { abbr: "è§’ç•Œ", formal: ["ç›¸æ’²ç•Œ"], type: 'sumo', level: 2 },
        { abbr: "é‡‘æ˜Ÿ", formal: ["å¹³å¹•ãŒæ¨ªç¶±ã«å‹ã¤ã“ã¨"], type: 'sumo', level: 2 },
        { abbr: "ã¡ã‚ƒã‚“ã“", formal: ["åŠ›å£«ã®é£Ÿäº‹"], type: 'sumo', level: 2 },
        { abbr: "ã‚¿ãƒ‹ãƒãƒ", formal: ["ã²ã„ãã«ã—ã¦ãã‚Œã‚‹å®¢", "ã‚¹ãƒãƒ³ã‚µãƒ¼"], type: 'sumo', level: 2 },
        { abbr: "ã‹ã‚ã„ãŒã‚Š", formal: ["å³ã—ã„ç¨½å¤"], type: 'sumo', level: 3 },
        { abbr: "ç ‚ã‹ã¶ã‚Š", formal: ["æºœå¸­", "åœŸä¿µä¸‹ã®å¸­"], type: 'sumo', level: 3 },
        { abbr: "å¼“å–ã‚Š", formal: ["å¼“å–ã‚Šå¼"], type: 'sumo', level: 3 },
        { abbr: "ãƒã‚²", formal: ["å¤§éŠ€æ", "ä¸é«·"], type: 'sumo', level: 3 }
    ];

    let currentPlayMode='choice', currentType='std', activeQuestionList=[], currentQuestionIndex=0, score=0;

    const menuScreen=document.getElementById('menu-screen'), gameScreen=document.getElementById('game-screen'), endScreen=document.getElementById('end-screen');
    
    function setPlayMode(mode, btn) {
        currentPlayMode=mode; document.querySelectorAll('.play-mode-btn').forEach(b=>b.classList.remove('selected')); btn.classList.add('selected');
    }
    function toggleGalMenu() {
        const m=document.getElementById('gal-era-select');
        if(m.style.display==='none'){ m.style.display='block'; setTimeout(()=>m.scrollIntoView({behavior:"smooth",block:"nearest"}),50); }
        else m.style.display='none';
    }
    function shuffleArray(arr) { for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }

    function startSpecialGame(type) {
        initAudio(); currentType=type; document.body.className = type+'-mode';
        const target = masterQuizData.filter(q=>q.type===type);
        activeQuestionList = shuffleArray(target).slice(0,10);
        if(activeQuestionList.length===0) activeQuestionList=masterQuizData.slice(0,5);
        startGameCommon();
    }
    function startGalGame(era) {
        initAudio(); currentType='gal'; document.body.className='gal-mode';
        const target = masterQuizData.filter(q=>q.type==='gal'&&q.era===era);
        activeQuestionList = shuffleArray(target).slice(0,10);
        startGameCommon();
    }

    function startGameCommon() {
        currentQuestionIndex=0; score=0;
        menuScreen.classList.remove('active'); endScreen.classList.remove('active'); gameScreen.classList.add('active');
        document.getElementById('choice-area').style.display=(currentPlayMode==='choice')?'block':'none';
        document.getElementById('solo-area').style.display=(currentPlayMode==='solo')?'block':'none';
        document.getElementById('party-area').style.display=(currentPlayMode==='party')?'block':'none';
        showQuestion();
    }

    function showQuestion() {
        const q=activeQuestionList[currentQuestionIndex];
        document.getElementById('question-text').textContent = q.abbr;
        
        const badge=document.getElementById('info-badge');
        badge.textContent = (q.level?"LEVEL "+q.level : (q.era==='showa'?"æ˜­å’Œ":q.era==='heisei'?"å¹³æˆ":"ä»¤å’Œ"));
        badge.style.background = 
            (currentType==='police')?"#f1c40f": 
            (currentType==='gal')?"#ff69b4": 
            (currentType==='biz')?"#003366": 
            (currentType==='otaku')?"#9b59b6": 
            (currentType==='medical')?"#16a085": 
            (currentType==='netslang')?"#e67e22": 
            (currentType==='sumo')?"#8d6e63": 
            "#27ae60";
        
        document.getElementById('progress-fill').style.width = `${(currentQuestionIndex/activeQuestionList.length)*100}%`;
        document.getElementById('result-area').style.display="none";
        document.getElementById('party-answer-box').style.display="none";
        document.getElementById('party-reveal-btn').style.display="inline-block";

        if(currentPlayMode==='choice') setupChoice(q);
        else if(currentPlayMode==='solo') setupSolo();
        window.scrollTo(0,0);
    }

    function setupChoice(q) {
        const con=document.getElementById('choices-container'); con.innerHTML='';
        const correct=q.formal[0];
        let pool=masterQuizData.filter(d=>d.formal[0]!==correct);
        if(pool.length<3) pool=masterQuizData; 
        const dummies=shuffleArray(pool).slice(0,3).map(d=>d.formal[0]);
        shuffleArray([correct, ...dummies]).forEach(c=>{
            const btn=document.createElement('button'); btn.className='choice-btn'; btn.textContent=c;
            btn.onclick=()=>checkChoice(c,btn,correct); con.appendChild(btn);
        });
    }

    function checkChoice(sel, btn, cor) {
        document.querySelectorAll('.choice-btn').forEach(b=>{ b.disabled=true; if(b.textContent===cor) b.classList.add('correct-choice'); });
        const isCor=(sel===cor); if(isCor) score++; else btn.classList.add('wrong-choice');
        showResult(isCor, cor);
    }

    function setupSolo() {
        const inp=document.getElementById('answer-input'); inp.value=""; inp.disabled=false; inp.focus();
        document.getElementById('solo-submit-btn').style.display="inline-block";
    }
    function checkSoloAnswer() {
        const inp=document.getElementById('answer-input'); const u=inp.value.replace(/[\sã€€ãƒ»]/g,"").toLowerCase();
        const cors=activeQuestionList[currentQuestionIndex].formal;
        const isCor=cors.some(c=>c.replace(/[\sã€€ãƒ»]/g,"").toLowerCase()===u);
        inp.disabled=true; document.getElementById('solo-submit-btn').style.display="none";
        if(isCor) score++;
        showResult(isCor, cors[0]);
    }

    function revealPartyAnswer() {
        const q=activeQuestionList[currentQuestionIndex];
        document.getElementById('party-correct-text').textContent=q.formal[0];
        document.getElementById('party-alt-text').textContent=(q.formal.length>1)?q.formal.slice(1).join(', '):"-";
        document.getElementById('party-reveal-btn').style.display="none";
        document.getElementById('party-answer-box').style.display="block";
        playSound('correct');
    }

    function showResult(isCor, ans) {
        const area=document.getElementById('result-area'), msg=document.getElementById('result-msg'), txt=document.getElementById('correct-text');
        area.style.display="block"; txt.textContent=ans;
        if(isCor) { playSound('correct'); msg.className="correct"; msg.textContent="æ­£è§£ï¼â­•ï¸"; }
        else { playSound('wrong'); msg.className="incorrect"; msg.textContent="æ®‹å¿µ...âŒ"; }
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if(currentQuestionIndex<activeQuestionList.length) showQuestion();
        else {
            gameScreen.classList.remove('active'); endScreen.classList.add('active');
            if(currentPlayMode!=='party') {
                document.getElementById('scored-end-area').style.display='block';
                document.getElementById('final-score').textContent=score;
                document.getElementById('total-count').textContent=activeQuestionList.length;
            } else {
                document.getElementById('scored-end-area').style.display='none';
            }
        }
    }
    
    document.addEventListener("keypress", (e)=>{
        if(e.key==="Enter" && currentPlayMode==='solo') {
            const btn=document.getElementById('solo-submit-btn');
            if(btn.style.display!=='none') checkSoloAnswer();
            else if(document.getElementById('result-area').style.display!=='none') nextQuestion();
        }
    });
</script>
</body>
</html>
